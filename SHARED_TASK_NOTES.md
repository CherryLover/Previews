# 共享任务记录

## 当前状态 (2025-11-21)

### P0 安全问题修复进度: 5/6 已完成

#### 已完成修复
1. ✅ **XSS 防护** (main.py:68-144, 535-548)
   - 实现了完整的 `sanitize_html()` 函数
   - 添加安全响应头: CSP, X-Frame-Options, X-Content-Type-Options
   - 禁用 Flask 默认 static 文件夹 (`static_folder=None`)

2. ✅ **速率限制** (main.py:11-22)
   - 安装并配置 Flask-Limiter
   - 全局限制: 200次/天, 50次/小时
   - CDN 代理限制: 100次/小时
   - 上传限制: 10次/小时

3. ✅ **代理请求大小限制** (main.py:28, 355-363)
   - 限制单次代理请求最大 10MB
   - 使用流式传输检查大小

4. ✅ **HTML 上传大小限制** (main.py:27-30, 396-398, 439-444)
   - Flask MAX_CONTENT_LENGTH: 1MB
   - 添加 413 错误处理器
   - 速率限制: 10次/小时

5. ✅ **调试模式安全** (main.py:538-540)
   - 改为从环境变量读取: `debug=os.environ.get('DEBUG', 'False').lower() == 'true'`
   - 生产环境默认关闭调试

#### 剩余 P0 任务
- **总存储配额限制** - 下一个应该实现的功能
  - 需要: 检查 static 目录总大小
  - 建议: 设置 500MB 或 1GB 配额
  - 实现位置: upload_html() 函数开头

## 下一步任务

1. 实现总存储配额限制 (P0)
2. 修复 P1 功能缺陷 (项目删除、自动清理等)
3. 修复 P1 性能问题 (分页、缓存、生产服务器)

## 重要提示

- HTML 预览工具的特殊性: 保留用户的完整 HTML 内容,通过安全头隔离
- Flask 默认会自动服务 `static/` 文件夹,已禁用并使用自定义路由
- 所有速率限制使用内存存储 (memory://),生产环境建议使用 Redis
